---
title: "Untitled"
author: "Yadu"
date: "November 17, 2016"
output: html_document
---

```{r}
dfTr <- read.csv("https://raw.githubusercontent.com/ChristopheHunt/DATA-621-Group-1/master/Homework%205/imputed_wine-training-data.csv")
library(ggplot2)
ggplot(stack(subset(dfTr, select = -TARGET)), aes(x = ind, y = values)) + geom_boxplot(fill = "grey80", colour = "#3366FF")
```

The variables that would need to be winsorized are Free Sulfur Dioxide, Residual Sugar, and Total Sulfur Dioxide. 

```{r}
library(forecast)

winsorize <- function(x, multiple=2.2)
{
  q <- quantile(x)
  iqr <- IQR(x)
  iqrAdjusted <- iqr*multiple

  rangeLow <- q['25%']-iqrAdjusted
  rangeHigh <- q['75%']+iqrAdjusted

  x[x<rangeLow] <- min(x[x>rangeLow])
  x[x>rangeHigh] <- max(x[x<rangeHigh])

  return(x)  

}

wDfTr <- cbind(sapply(c('FreeSulfurDioxide', 'TotalSulfurDioxide', 'ResidualSugar'), function(x) winsorize(dfTr[,x], multiple=2.2)), subset(dfTr, select = -c(FreeSulfurDioxide, TotalSulfurDioxide, ResidualSugar)))

fwDfTr <- rbind(wDfTr, dfTr$TARGET)
```

```{r}
library(car)
fit <- lm(TARGET ~ FreeSulfurDioxide + TotalSulfurDioxide + ResidualSugar + FixedAcidity + VolatileAcidity + CitricAcid + Chlorides + Density + pH + Sulphates + Alcohol + LabelAppeal + STARS, data=fwDfTr)
residualPlots(fit)
```

```{r}
fwDfTr$STARS <- factor(fwDfTr$STARS, levels=c(1,2,3,4))
fwDfTr$LabelAppeal <- factor(fwDfTr$LabelAppeal, levels=c(-2,-1,0,1,2,3))
library(MASS)
b1 <- glm.nb(TARGET ~ ResidualSugar + Alcohol + STARS, data=fwDfTr, link = log)
summary(b1) # Residual Sugar, STARS, Alcohol
b2 <- glm.nb(TARGET ~  CitricAcid + pH + LabelAppeal, data=fwDfTr, link = log)
summary(b2) # Label Appeal, Citric Acid, pH
```

In the first backwards model, all of the coefficients are positive. The standard error in this very high thus guaranteeing high variance. The theta value is also very high. This means that there is a high level of dispersion. 

In the second backwards model, all of the coefficients are positive except for that of pH. The standard error is 3.5. The theta value is 23.46, guaranteeing a lower level of overdispersion. 

In both models, the categorical variables - the label appeal and number of stars appear highly signficicant in predicting the target variable. 