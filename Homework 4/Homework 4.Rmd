---
title: "Homework 4"
author: "Group 1"
date: ''
output:
  pdf_document:
    includes:
      in_header: header.tex
    number_sections: yes
    toc: yes
    toc_depth: 2
  html_document:
    toc: yes
    toc_depth: '2'
---

```{r programming style guide, echo=FALSE, eval=FALSE}
##Style guide
##USE CAMEL CASING!! https://en.wikipedia.org/wiki/Camel_case, start with lowercase then each word after start with upper case
##upper case for vector, lists, etc. ex. X <- c("yes","no","true","false")
##lower case for scalar/single value, ex. x <- 1
##data frame start with df followed by description, ex. dfEval <- evaluation data frame
##assignments use "<-" not "="
```

```{r library load, include = FALSE}
library(pacman)
p_load(Hmisc, xlsx, xtable, knitr, scales, magrittr, tidyverse, stringr, e1071, corrplot, knitcitations, bibtex, missForest, abc, foreach, doParallel, stargazer, forecast, matrixStats, glmulti, leaps, data.table, highlight, car)
```

\begin{center}
\bigskip
\bigskip
\bigskip
Prepared for:\\
\medskip
Dr. Nathan Bastian\\
\smallskip
City University of New York, School of Professional Studies - Data 621\\
\bigskip
Prepared by:\\
\medskip
Group 1\\ 
\medskip
Senthil Dhanapal\\ 
\smallskip
Yadu Chittampalli\\
\smallskip
Christophe Hunt\\  

\end{center}

# Introduction

Consumers who own a car will then often purchase car insurance to protect themselves from serious financial repercussions of being involved in a car accident. Insurance Providers understand that most consumers will not be involved in accidents so they must determine accurate models to evaluate the risk of providing insurance protection to new consumers. As Insurance Providers are motivated by collecting the maximum amount of revenue from consumers while returning the lowest amount in accident coverage, statistical modeling provides Insurance Providers insight into the consumers behavior and the most appropriate pricing to provide the consumer coverage. 

# Statement of the Problem

The purpose of this report is to develop statistical models to better infer the likelihood of a customer being involved in a car accident and the cost associated of a customer being involved in a car accident. 

# Data Exploration  

## Variables Explained

The variables provided in our evaluation data set our explained below:

```{r data dictionary load, include=FALSE, cache=TRUE}
download.file("https://github.com/ChristopheHunt/DATA-621-Group-1/raw/master/Homework%204/Data%20Dictionary.xlsx?raw=true", destfile = "Data Dictionary HW4 - Group 1.xlsx", mode = 'wb')
daDict <- read.xlsx("Data Dictionary HW4 - Group 1.xlsx", sheetIndex = 1)
file.remove(dir(getwd(), pattern = "Data Dictionary HW4 - Group 1", full.names = TRUE))
```


```{r data dictionary table, eval=FALSE, results='asis', echo=FALSE}
kable(daDict %>% 
      mutate(`Variable Code` = VARIABLE.NAME, Definition = DEFINITION)  %>%
      dplyr::select(`Variable Code`, Definition),
      align = c("c","l"))
```

Histograms of most of our variables have been plotted below so that distribution can be visualized. 

```{r descriptive statistics table, echo=FALSE, results='asis', cache=TRUE}

dfTr <- read.csv("https://raw.githubusercontent.com/ChristopheHunt/DATA-621-Group-1/master/Homework%204/insurance_training_data.csv")

digits <- c(1)

descriptive <- describe( dfTr %>% dplyr::select(-INDEX, -TARGET_FLAG) 
                        , descript = "Table 1 : Descriptive Statistics", digits = digits)
latex(descriptive, file = '')
```

\newpage

## Exploration of Variables

```{r correlation matrix, fig.cap= "Correlation Plot of Training Data Set", echo = FALSE, fig.height = 3, fig.width= 8, cache=TRUE, eval=FALSE}

dfTr <- read.csv("https://raw.githubusercontent.com/ChristopheHunt/DATA-621-Group-1/master/Homework%204/insurance_training_data.csv")

removedollars <- function(column){
             as.numeric(gsub("\\,","",gsub("\\$","", column)))
          }

dfTr <- dfTr %>%
        mutate(INCOME = removedollars(INCOME),
               HOME_VAL = removedollars(HOME_VAL),
               BLUEBOOK = removedollars(BLUEBOOK),
               OLDCLAIM = removedollars(OLDCLAIM),
               MSTATUS = gsub("z_", "", MSTATUS),
               SEX = gsub("z_", "", SEX))

model <- lm(TARGET_AMT~., data = dfTr)



dfTrMx <- as.matrix(dfTr)
corMx <- cor(dfTrMx , use = "everything",  method = c("pearson"))
corrplot(corMx, order = "hclust", addrect = 2, method = "square", tl.col = "black", tl.cex = .75, na.label = " ")
```


